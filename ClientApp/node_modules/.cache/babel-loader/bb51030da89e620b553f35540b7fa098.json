{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\drack90\\\\source\\\\repos\\\\appTestRosneft\\\\ClientApp\\\\src\\\\components\\\\Pipline.js\";\nimport React, { Component } from 'react';\nimport { render } from 'react-dom'; //import { CanvasBoard } from './CanvasBoard'\n//mport { PiplineSegment } from './PiplineSegment'\n\nimport './css/Pipline.css';\nimport { PiplineSegment } from './PiplineSegment';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport class Pipline extends Component {\n  constructor() {\n    super(...arguments);\n    this.state = {\n      piplinesSegmentCount: 0\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"section\", {\n      className: \"piplineSections\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"alert alert-danger alert-dismissible fade\",\n        id: \"alert-message\",\n        role: \"alert\",\n        children: [\"\\u0423\\u0434\\u0430\\u043B\\u044F\\u0442\\u044C \\u043C\\u043E\\u0436\\u043D\\u043E \\u0442\\u043E\\u043B\\u044C\\u043A\\u043E \\u0442\\u043E\\u0447\\u043A\\u0438 \\u0441\\u043A\\u0440\\u0430\\u044E \\u0442\\u0440\\u0443\\u0431\\u043E\\u043F\\u0440\\u043E\\u0432\\u043E\\u0434\\u0430\", /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: \"close\",\n          \"data-dismiss\": \"alert\",\n          \"aria-label\": \"Close\",\n          onClick: closeAlert,\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            \"aria-hidden\": \"true\",\n            children: \"\\xD7\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 21,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 20,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 18,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"container\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pipline-title mx-auto\",\n          children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n            children: \"\\u0422\\u0435\\u0441\\u0442\\u043E\\u0432\\u043E\\u0435 \\u0437\\u0430\\u0434\\u0430\\u043D\\u0438\\u0435\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 26,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"h6\", {\n            children: \"\\u0417\\u0430\\u0434\\u0430\\u0447\\u0430: \\u0440\\u0435\\u0430\\u043B\\u0438\\u0437\\u043E\\u0432\\u0430\\u0442\\u044C \\u043F\\u043E\\u0441\\u0442\\u0440\\u043E\\u0435\\u043D\\u0438\\u0435 \\u0438 \\u043E\\u0431\\u0440\\u0430\\u0431\\u043E\\u0442\\u043A\\u0443 \\u0442\\u0440\\u0443\\u0431\\u043E\\u043F\\u0440\\u043E\\u0432\\u043E\\u0434\\u043E\\u0432 \\u0441 \\u043F\\u0440\\u043E\\u0432\\u0435\\u0440\\u043A\\u043E\\u0439 \\u043A\\u043E\\u043B\\u043B\\u0438\\u0437\\u0438\\u0439\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 27,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 25,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-xxl-8 col-xl-8 col-lg-8\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"canvasContainer\",\n              children: /*#__PURE__*/_jsxDEV(\"canvas\", {\n                id: \"piplineCanvas\",\n                width: \"700\",\n                height: \"350\",\n                onMouseDown: e => {\n                  let newEvent = e.nativeEvent;\n                  HandleMouseDown(newEvent);\n                },\n                onMouseUp: e => {\n                  let newEvent = e.nativeEvent;\n                  HandleMouseUp(newEvent);\n                },\n                onMouseMove: e => {\n                  let newEvent = e.nativeEvent;\n                  HandleMouseMove(newEvent);\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 32,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 31,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 30,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-xxl-4 col-xl-4 col-lg-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"boardContainer\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"canvasBoard_componen\",\n                children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"btn btn-primary\",\n                  onClick: AddPipline,\n                  children: \" \\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u043D\\u043E\\u0432\\u044B\\u0439 \\u0442\\u0440\\u0443\\u0431\\u043E\\u043F\\u0440\\u043E\\u0432\\u043E\\u0434 \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 51,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"btn btn-success\",\n                  onClick: SetAddPointActive,\n                  children: \" \\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0443\\u0437\\u0435\\u043B \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 52,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"btn btn-danger\",\n                  onClick: deleteSelectedPoint,\n                  children: \" \\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C \\u0443\\u0437\\u0435\\u043B \"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 53,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"btn btn-warning\",\n                  onClick: getCollisium,\n                  children: \" \\u0420\\u0430\\u0441\\u0441\\u0447\\u0438\\u0442\\u0430\\u0442\\u044C \\u043F\\u0435\\u0440\\u0435\\u0441\\u0435\\u0447\\u0435\\u043D\\u0438\\u044F\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 54,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 50,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 49,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"piplineElements\",\n              id: \"piplineItems\",\n              children: /*#__PURE__*/_jsxDEV(\"ul\", {\n                className: \"piplineList\",\n                id: \"piplineList\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 58,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 57,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 48,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 29,\n          columnNumber: 20\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 24,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 17,\n      columnNumber: 13\n    }, this);\n  }\n\n}\nPipline.dislpayName = Pipline.name;\nlet piplines = [];\nlet mouseDown = false;\nlet piplinesCount = 0;\nlet defaultId = 0;\nlet defaultPoint = [0, 0];\nlet AddPointActive = false;\nlet downOnSelected = false;\nlet points = [];\nlet selectedNumber = -1;\nlet activePipline = -1;\nlet linesArr = [];\n\nfunction SetAddPointActive(pipline, point) {\n  AddPointActive = true;\n  console.log(\"Add active\");\n}\n\n_c = SetAddPointActive;\n\nlet renderAlert = () => {\n  document.getElementById('alert-message').classList.add('show');\n  autoCloseAlert();\n};\n\nlet autoCloseAlert = () => {\n  setTimeout(() => {\n    closeAlert();\n  }, 3000);\n};\n\nlet closeAlert = () => {\n  document.getElementById('alert-message').classList.remove('show');\n};\n\nfunction renderPiplineItems() {\n  return render(piplines.map((item, key) => /*#__PURE__*/_jsxDEV(\"li\", {\n    id: key + \"pipline\",\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"pipline-btn\",\n      type: \"button\",\n      onClick: () => setPipline(key),\n      children: item.name\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      type: \"button\",\n      className: \"close red\",\n      \"aria-label\": \"Close\",\n      onClick: () => DeletePipline(item.id),\n      children: /*#__PURE__*/_jsxDEV(\"span\", {\n        \"aria-hidden\": \"true\",\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 29\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 21\n    }, this)]\n  }, item.id, true, {\n    fileName: _jsxFileName,\n    lineNumber: 112,\n    columnNumber: 13\n  }, this)), document.getElementById('piplineList'));\n} //TODO поправить назначение активного пайплпайна при удалении. Сейчас он на ID ссылается, а надо на ключь\n//НУЖНО ИСПОЛЬЗОВАТЬ НЕ ID а KEY\n\n\nfunction setPipline(key) {\n  if (activePipline !== key && activePipline !== -1 && document.getElementById(activePipline + \"pipline\")) {\n    document.getElementById(activePipline + \"pipline\").classList.remove('pipline-btn__active');\n  }\n\n  let pipline = document.getElementById(key + \"pipline\");\n\n  if (pipline) {\n    pipline.classList.add('pipline-btn__active');\n    activePipline = key;\n  }\n}\n\nfunction getRandomColor() {\n  var letters = '0123456789ABCDEF';\n  var color = '#';\n\n  for (var i = 0; i < 6; i++) {\n    color += letters[Math.floor(Math.random() * 16)];\n  }\n\n  return color;\n}\n\nfunction AddPipline() {\n  let color = getRandomColor();\n  let pipline = {\n    id: piplinesCount + 1,\n    name: \"Трубопровод \" + (piplinesCount + 1),\n    color: color,\n    points: []\n  };\n  piplines.push(pipline);\n  piplinesCount += 1;\n  renderPiplineItems();\n\n  if (piplines.length <= 1) {\n    activePipline = 0;\n    setPipline(0);\n  }\n} //Проверить перед деплоем\n\n\n_c2 = AddPipline;\n\nfunction DeletePipline(id) {\n  for (const key in piplines) {\n    if (Object.hasOwnProperty.call(piplines, key)) {\n      const pipline = piplines[key];\n\n      if (pipline.id === id) {\n        console.log(key);\n\n        if (key === '0') {\n          console.log(\"0000\");\n          piplines.shift();\n          piplinesCount = 0;\n          activePipline = -1;\n        } else {\n          piplines.splice(key, key);\n        }\n\n        renderPiplineItems();\n        DrawPipeline();\n      }\n    }\n  }\n}\n\n_c3 = DeletePipline;\n\nlet deleteSelectedPoint = () => {\n  // if(selectedNumber && selectedNumber.point === 0 || selectedNumber.point === piplines[selectedNumber.key].points.length -1){\n  if (selectedNumber && selectedNumber.point === 0) {\n    piplines[selectedNumber.key].points.shift();\n    selectedNumber = -1;\n    DrawPipeline();\n  } else if (selectedNumber && selectedNumber.point === piplines[selectedNumber.key].points.length - 1) {\n    piplines[selectedNumber.key].points.pop();\n    selectedNumber = -1;\n    DrawPipeline();\n  } else {\n    renderAlert();\n    console.log('====================================');\n    console.log(\"точка  должна быть крайней в трубопроводе\");\n    console.log('====================================');\n  } // piplines[selectedNumber.key].points.splice(selectedNumber.point, 1)\n\n};\n\nlet activeCanvas = () => {\n  let canvas = document.getElementById('piplineCanvas').classList.toggle('canvas_active');\n};\n\nlet addPointsToPipline = (piplineIndex, x, y) => {\n  let point = {\n    x,\n    y\n  };\n  piplines[piplineIndex].points.push(point);\n};\n\nfunction TrySelectPoint(x, y) {\n  piplines.forEach((pipline, key) => {\n    for (var i = 0; i < pipline.points.length; i++) {\n      var point = pipline.points[i];\n      console.log(point);\n\n      if (x >= point.x - 5 && x <= point.x + 5 && y >= point.y - 5 && y <= point.y + 5) {\n        selectedNumber = {\n          key: key,\n          point: i\n        };\n        DrawPipeline();\n        downOnSelected = true;\n        break;\n      }\n    }\n  });\n}\n\n_c4 = TrySelectPoint;\n\nfunction HandleMouseDown(event) {\n  mouseDown = true;\n\n  if (AddPointActive) {\n    var x = event.offsetX;\n    var y = event.offsetY;\n    addPointsToPipline(activePipline, x, y);\n    DrawPipeline();\n    AddPointActive = false;\n  } else {\n    x = event.offsetX;\n    y = event.offsetY;\n    TrySelectPoint(x, y);\n  }\n}\n\n_c5 = HandleMouseDown;\n\nfunction HandleMouseMove(event) {\n  if (mouseDown) {\n    if (downOnSelected) {\n      let point = piplines[selectedNumber.key].points[selectedNumber.point];\n      point.x = event.offsetX;\n      point.y = event.offsetY;\n      DrawPipeline();\n    }\n  }\n}\n\n_c6 = HandleMouseMove;\n\nfunction HandleMouseUp() {\n  mouseDown = false;\n  downOnSelected = false;\n}\n\n_c7 = HandleMouseUp;\n\nfunction DrawPipeline() {\n  var canvas = document.getElementById('piplineCanvas');\n  var ctx = canvas.getContext('2d');\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n  if (points.length > 0) {\n    console.log('driwe line');\n    DrawLines();\n  }\n\n  piplines.forEach((pipline, keys) => {\n    for (const key in pipline.points) {\n      if (Object.hasOwnProperty.call(pipline.points, key)) {\n        if (pipline.points.length > 0) {\n          DrawLines();\n        }\n\n        const point = pipline.points[key];\n\n        if (Number(keys) === selectedNumber.key && Number(key) === selectedNumber.point) {\n          DrawPoint(point.x, point.y, \"blue\");\n        } else {\n          DrawPoint(point.x, point.y, pipline.color);\n        }\n      }\n    }\n  });\n}\n\n_c8 = DrawPipeline;\n\nfunction DrawPoint(x, y, color) {\n  var canvas = document.getElementById('piplineCanvas');\n  var ctx = canvas.getContext('2d');\n  ctx.beginPath();\n  ctx.arc(x, y, 5, 0, getRadians(360));\n  ctx.fillStyle = color;\n  ctx.moveTo(x, y);\n  ctx.fill();\n}\n\n_c9 = DrawPoint;\n\nfunction DrawLines() {\n  var canvas = document.getElementById('piplineCanvas');\n  var ctx = canvas.getContext('2d');\n  console.log('drawLines');\n\n  for (const key in piplines) {\n    if (Object.hasOwnProperty.call(piplines, key)) {\n      const pipline = piplines[key];\n\n      if (pipline.points.length > 0) {\n        ctx.moveTo(pipline.points[0].x, pipline.points[0].y);\n        console.log(pipline);\n\n        for (var i = 0; i < pipline.points.length; i++) {\n          ctx.lineTo(pipline.points[i].x, pipline.points[i].y);\n          ctx.strokeStyle = pipline.color;\n        }\n      }\n    }\n\n    ctx.stroke();\n    ctx.beginPath();\n  }\n}\n\n_c10 = DrawLines;\n\nfunction getRadians(degrees) {\n  return Math.PI / 180 * degrees;\n}\n\nlet intersect = (x1, y1, x2, y2, x3, y3, x4, y4) => {\n  // Check if none of the lines are of length 0\n  if (x1 === x2 && y1 === y2 || x3 === x4 && y3 === y4) {\n    return false;\n  }\n\n  let denominator = (y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1); // Lines are parallel\n\n  if (denominator === 0) {\n    return false;\n  }\n\n  let ua = ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) / denominator;\n  let ub = ((x2 - x1) * (y1 - y3) - (y2 - y1) * (x1 - x3)) / denominator; // is the intersection along the segments\n\n  if (ua < 0 || ua > 1 || ub < 0 || ub > 1) {\n    return false;\n  } // Return a object with the x and y coordinates of the intersection\n\n\n  let x = x1 + ua * (x2 - x1);\n  let y = y1 + ua * (y2 - y1);\n  return {\n    x,\n    y\n  };\n};\n\nlet getCollisium = () => {\n  //при первой иттерации, убираем первый элемент первого массива из расчетов т.к. с ним высчитывать уже нет смысла - т.к. в первой же иттерации он сравнивает себя с всеми отрезками \n  let allLines = getAlllines();\n  console.log(allLines);\n\n  for (let i = 0; i < allLines.length - 1; i++) {\n    for (let y = 1; y < allLines.length; y++) {\n      const line1 = allLines[i];\n      console.log('====================================');\n      console.log(\"itteration № \" + i);\n      console.log('====================================');\n      const line2 = allLines[y]; //let point = line_intersect(line1, line2);\n\n      let point = intersect(line1.x1, line1.y1, line1.x2, line1.y2, line2.x1, line2.y1, line2.x2, line2.y2);\n      console.log(point);\n\n      if (point.x && point.y) {\n        if (point.x < 0 && point.y < 0) {\n          console.log('====================================');\n          console.log('break');\n          console.log('====================================');\n        } else if (point.x == line1.x2 && point.y == line1.y2 || point.x == line2.x1 && point.y == line2.y1 || point.x == line1.x1 && point.y == line1.y1 || point.x == line2.x2 && point.y == line2.y2) {\n          console.log('====================================');\n          console.log(\"point\");\n          console.log('====================================');\n        } else {\n          DrawPoint(point.x, point.y, \"red\");\n        }\n      }\n    }\n  }\n};\n\nlet getAlllines = () => {\n  let allLines = [];\n\n  for (let i = 0; i < piplines.length; i++) {\n    //количество иттераций от количества пайплайнов:\n    for (let y = 0; y < piplines[i].points.length; y++) {\n      //вложенные иттерации от количества поинтов в пайплайне \n      let line1 = {};\n\n      if (piplines[i].points[y + 1]) {\n        line1 = {\n          x1: piplines[i].points[y].x,\n          y1: piplines[i].points[y].y,\n          x2: piplines[i].points[y + 1].x,\n          y2: piplines[i].points[y + 1].y\n        };\n        allLines.push(line1);\n      } else {\n        break;\n      }\n    }\n  }\n\n  return allLines;\n};\n\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9, _c10;\n\n$RefreshReg$(_c, \"SetAddPointActive\");\n$RefreshReg$(_c2, \"AddPipline\");\n$RefreshReg$(_c3, \"DeletePipline\");\n$RefreshReg$(_c4, \"TrySelectPoint\");\n$RefreshReg$(_c5, \"HandleMouseDown\");\n$RefreshReg$(_c6, \"HandleMouseMove\");\n$RefreshReg$(_c7, \"HandleMouseUp\");\n$RefreshReg$(_c8, \"DrawPipeline\");\n$RefreshReg$(_c9, \"DrawPoint\");\n$RefreshReg$(_c10, \"DrawLines\");","map":{"version":3,"sources":["C:/Users/drack90/source/repos/appTestRosneft/ClientApp/src/components/Pipline.js"],"names":["React","Component","render","PiplineSegment","Pipline","state","piplinesSegmentCount","closeAlert","e","newEvent","nativeEvent","HandleMouseDown","HandleMouseUp","HandleMouseMove","AddPipline","SetAddPointActive","deleteSelectedPoint","getCollisium","dislpayName","name","piplines","mouseDown","piplinesCount","defaultId","defaultPoint","AddPointActive","downOnSelected","points","selectedNumber","activePipline","linesArr","pipline","point","console","log","renderAlert","document","getElementById","classList","add","autoCloseAlert","setTimeout","remove","renderPiplineItems","map","item","key","setPipline","DeletePipline","id","getRandomColor","letters","color","i","Math","floor","random","push","length","Object","hasOwnProperty","call","shift","splice","DrawPipeline","pop","activeCanvas","canvas","toggle","addPointsToPipline","piplineIndex","x","y","TrySelectPoint","forEach","event","offsetX","offsetY","ctx","getContext","clearRect","width","height","DrawLines","keys","Number","DrawPoint","beginPath","arc","getRadians","fillStyle","moveTo","fill","lineTo","strokeStyle","stroke","degrees","PI","intersect","x1","y1","x2","y2","x3","y3","x4","y4","denominator","ua","ub","allLines","getAlllines","line1","line2"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,MAAT,QAAuB,WAAvB,C,CACA;AACA;;AACA,OAAO,mBAAP;AACA,SAASC,cAAT,QAA+B,kBAA/B;;AAEA,OAAO,MAAMC,OAAN,SAAsBH,SAAtB,CAAgC;AAAA;AAAA;AAAA,SAGnCI,KAHmC,GAG3B;AACJC,MAAAA,oBAAoB,EAAE;AADlB,KAH2B;AAAA;;AAOnCJ,EAAAA,MAAM,GAAE;AACJ,wBACI;AAAS,MAAA,SAAS,EAAC,iBAAnB;AAAA,8BACI;AAAK,QAAA,SAAS,EAAC,2CAAf;AAA2D,QAAA,EAAE,EAAC,eAA9D;AAA8E,QAAA,IAAI,EAAC,OAAnF;AAAA,yRAEQ;AAAQ,UAAA,IAAI,EAAC,QAAb;AAAsB,UAAA,SAAS,EAAC,OAAhC;AAAwC,0BAAa,OAArD;AAA6D,wBAAW,OAAxE;AAAgF,UAAA,OAAO,EAAEK,UAAzF;AAAA,iCACI;AAAM,2BAAY,MAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,gBAFR;AAAA;AAAA;AAAA;AAAA;AAAA,cADJ,eAOI;AAAK,QAAA,SAAS,EAAC,WAAf;AAAA,gCACI;AAAK,UAAA,SAAS,EAAC,uBAAf;AAAA,kCACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADJ,eAEI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAFJ;AAAA;AAAA;AAAA;AAAA;AAAA,gBADJ,eAKG;AAAK,UAAA,SAAS,EAAC,KAAf;AAAA,kCACK;AAAK,YAAA,SAAS,EAAC,6BAAf;AAAA,mCACI;AAAK,cAAA,SAAS,EAAC,iBAAf;AAAA,qCACI;AAAQ,gBAAA,EAAE,EAAC,eAAX;AAA2B,gBAAA,KAAK,EAAC,KAAjC;AAAuC,gBAAA,MAAM,EAAC,KAA9C;AACI,gBAAA,WAAW,EAAGC,CAAD,IAAO;AAChB,sBAAIC,QAAQ,GAAGD,CAAC,CAACE,WAAjB;AACAC,kBAAAA,eAAe,CAACF,QAAD,CAAf;AACH,iBAJL;AAKI,gBAAA,SAAS,EAAED,CAAC,IAAI;AACZ,sBAAIC,QAAQ,GAAGD,CAAC,CAACE,WAAjB;AACAE,kBAAAA,aAAa,CAACH,QAAD,CAAb;AACH,iBARL;AASI,gBAAA,WAAW,EAAED,CAAC,IAAI;AACd,sBAAIC,QAAQ,GAAGD,CAAC,CAACE,WAAjB;AACAG,kBAAAA,eAAe,CAACJ,QAAD,CAAf;AACH;AAZL;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,kBADL,eAmBK;AAAK,YAAA,SAAS,EAAC,6BAAf;AAAA,oCACI;AAAK,cAAA,SAAS,EAAC,gBAAf;AAAA,qCACI;AAAK,gBAAA,SAAS,EAAC,sBAAf;AAAA,wCACI;AAAQ,kBAAA,SAAS,EAAC,iBAAlB;AAAoC,kBAAA,OAAO,EAAEK,UAA7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBADJ,eAEI;AAAQ,kBAAA,SAAS,EAAC,iBAAlB;AAAoC,kBAAA,OAAO,EAAEC,iBAA7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAFJ,eAGI;AAAQ,kBAAA,SAAS,EAAC,gBAAlB;AAAmC,kBAAA,OAAO,EAAEC,mBAA5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAHJ,eAII;AAAQ,kBAAA,SAAS,EAAC,iBAAlB;AAAoC,kBAAA,OAAO,EAAEC,YAA7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAJJ;AAAA;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,oBADJ,eASI;AAAK,cAAA,SAAS,EAAC,iBAAf;AAAiC,cAAA,EAAE,EAAC,cAApC;AAAA,qCACI;AAAI,gBAAA,SAAS,EAAC,aAAd;AAA4B,gBAAA,EAAE,EAAC;AAA/B;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,oBATJ;AAAA;AAAA;AAAA;AAAA;AAAA,kBAnBL;AAAA;AAAA;AAAA;AAAA;AAAA,gBALH;AAAA;AAAA;AAAA;AAAA;AAAA,cAPJ;AAAA;AAAA;AAAA;AAAA;AAAA,YADJ;AAoDH;;AA5DkC;AAA1Bb,O,CACFc,W,GAAcd,OAAO,CAACe,I;AAmEjC,IAAIC,QAAQ,GAAG,EAAf;AACA,IAAIC,SAAS,GAAG,KAAhB;AACA,IAAIC,aAAa,GAAG,CAApB;AACA,IAAIC,SAAS,GAAG,CAAhB;AACA,IAAIC,YAAY,GAAG,CAAC,CAAD,EAAI,CAAJ,CAAnB;AACA,IAAIC,cAAc,GAAG,KAArB;AACA,IAAIC,cAAc,GAAG,KAArB;AACA,IAAIC,MAAM,GAAG,EAAb;AACA,IAAIC,cAAc,GAAG,CAAC,CAAtB;AACA,IAAIC,aAAa,GAAG,CAAC,CAArB;AACA,IAAIC,QAAQ,GAAG,EAAf;;AAIA,SAASf,iBAAT,CAA2BgB,OAA3B,EAAoCC,KAApC,EAA2C;AACvCP,EAAAA,cAAc,GAAG,IAAjB;AACAQ,EAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACH;;KAHQnB,iB;;AAMT,IAAIoB,WAAW,GAAG,MAAM;AACpBC,EAAAA,QAAQ,CAACC,cAAT,CAAwB,eAAxB,EAAyCC,SAAzC,CAAmDC,GAAnD,CAAuD,MAAvD;AACAC,EAAAA,cAAc;AACjB,CAHD;;AAIA,IAAIA,cAAc,GAAG,MAAM;AACvBC,EAAAA,UAAU,CAAC,MAAM;AACblC,IAAAA,UAAU;AACb,GAFS,EAEP,IAFO,CAAV;AAGH,CAJD;;AAKA,IAAIA,UAAU,GAAE,MAAM;AAClB6B,EAAAA,QAAQ,CAACC,cAAT,CAAwB,eAAxB,EAAyCC,SAAzC,CAAmDI,MAAnD,CAA0D,MAA1D;AACH,CAFD;;AAIA,SAASC,kBAAT,GAA8B;AAC1B,SAAOzC,MAAM,CACTkB,QAAQ,CAACwB,GAAT,CAAa,CAACC,IAAD,EAAOC,GAAP,kBACT;AAAkB,IAAA,EAAE,EAAEA,GAAG,GAAG,SAA5B;AAAA,4BACI;AAAQ,MAAA,SAAS,EAAC,aAAlB;AAAgC,MAAA,IAAI,EAAC,QAArC;AAA8C,MAAA,OAAO,EAAE,MAAKC,UAAU,CAACD,GAAD,CAAtE;AAAA,gBAA8ED,IAAI,CAAC1B;AAAnF;AAAA;AAAA;AAAA;AAAA,YADJ,eAEQ;AAAQ,MAAA,IAAI,EAAC,QAAb;AAAsB,MAAA,SAAS,EAAC,WAAhC;AAA4C,oBAAW,OAAvD;AAA+D,MAAA,OAAO,EAAE,MAAI6B,aAAa,CAACH,IAAI,CAACI,EAAN,CAAzF;AAAA,6BACQ;AAAM,uBAAY,MAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADR;AAAA;AAAA;AAAA;AAAA,YAFR;AAAA,KAASJ,IAAI,CAACI,EAAd;AAAA;AAAA;AAAA;AAAA,UADJ,CADS,EASTb,QAAQ,CAACC,cAAT,CAAwB,aAAxB,CATS,CAAb;AAWH,C,CACD;AACA;;;AACA,SAASU,UAAT,CAAoBD,GAApB,EAAyB;AACrB,MAAIjB,aAAa,KAAKiB,GAAlB,IAAyBjB,aAAa,KAAK,CAAC,CAA5C,IAAiDO,QAAQ,CAACC,cAAT,CAAwBR,aAAa,GAAG,SAAxC,CAArD,EAAyG;AACrGO,IAAAA,QAAQ,CAACC,cAAT,CAAwBR,aAAa,GAAG,SAAxC,EAAmDS,SAAnD,CAA6DI,MAA7D,CAAoE,qBAApE;AACH;;AACD,MAAIX,OAAO,GAAGK,QAAQ,CAACC,cAAT,CAAwBS,GAAG,GAAG,SAA9B,CAAd;;AAEA,MAAGf,OAAH,EAAW;AACPA,IAAAA,OAAO,CAACO,SAAR,CAAkBC,GAAlB,CAAsB,qBAAtB;AACAV,IAAAA,aAAa,GAAGiB,GAAhB;AAEH;AAEJ;;AAED,SAASI,cAAT,GAA0B;AACtB,MAAIC,OAAO,GAAG,kBAAd;AACA,MAAIC,KAAK,GAAG,GAAZ;;AACA,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AACxBD,IAAAA,KAAK,IAAID,OAAO,CAACG,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgB,EAA3B,CAAD,CAAhB;AACH;;AACD,SAAOJ,KAAP;AACH;;AAED,SAAStC,UAAT,GAAsB;AAClB,MAAIsC,KAAK,GAAGF,cAAc,EAA1B;AACA,MAAInB,OAAO,GAAG;AACVkB,IAAAA,EAAE,EAAE3B,aAAa,GAAG,CADV;AAEVH,IAAAA,IAAI,EAAE,kBAAkBG,aAAa,GAAG,CAAlC,CAFI;AAGV8B,IAAAA,KAAK,EAAEA,KAHG;AAIVzB,IAAAA,MAAM,EAAE;AAJE,GAAd;AAMAP,EAAAA,QAAQ,CAACqC,IAAT,CAAc1B,OAAd;AACAT,EAAAA,aAAa,IAAI,CAAjB;AACAqB,EAAAA,kBAAkB;;AAClB,MAAIvB,QAAQ,CAACsC,MAAT,IAAmB,CAAvB,EAA0B;AACtB7B,IAAAA,aAAa,GAAG,CAAhB;AACAkB,IAAAA,UAAU,CAAC,CAAD,CAAV;AACH;AAEJ,C,CAGD;;;MAnBSjC,U;;AAoBT,SAASkC,aAAT,CAAuBC,EAAvB,EAA2B;AAEvB,OAAK,MAAMH,GAAX,IAAkB1B,QAAlB,EAA4B;AACxB,QAAIuC,MAAM,CAACC,cAAP,CAAsBC,IAAtB,CAA2BzC,QAA3B,EAAqC0B,GAArC,CAAJ,EAA+C;AAC3C,YAAMf,OAAO,GAAGX,QAAQ,CAAC0B,GAAD,CAAxB;;AACA,UAAGf,OAAO,CAACkB,EAAR,KAAeA,EAAlB,EAAqB;AACjBhB,QAAAA,OAAO,CAACC,GAAR,CAAYY,GAAZ;;AACA,YAAGA,GAAG,KAAK,GAAX,EAAe;AACXb,UAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACAd,UAAAA,QAAQ,CAAC0C,KAAT;AACAxC,UAAAA,aAAa,GAAG,CAAhB;AACAO,UAAAA,aAAa,GAAG,CAAC,CAAjB;AACH,SALD,MAKK;AACDT,UAAAA,QAAQ,CAAC2C,MAAT,CAAgBjB,GAAhB,EAAqBA,GAArB;AACH;;AACDH,QAAAA,kBAAkB;AAClBqB,QAAAA,YAAY;AACf;AACJ;AACJ;AACJ;;MApBQhB,a;;AAsBT,IAAIhC,mBAAmB,GAAG,MAAK;AAC3B;AACI,MAAGY,cAAc,IAAIA,cAAc,CAACI,KAAf,KAAyB,CAA9C,EAAgD;AAC5CZ,IAAAA,QAAQ,CAACQ,cAAc,CAACkB,GAAhB,CAAR,CAA6BnB,MAA7B,CAAoCmC,KAApC;AACAlC,IAAAA,cAAc,GAAG,CAAC,CAAlB;AACAoC,IAAAA,YAAY;AACf,GAJD,MAIM,IAAGpC,cAAc,IAAIA,cAAc,CAACI,KAAf,KAAyBZ,QAAQ,CAACQ,cAAc,CAACkB,GAAhB,CAAR,CAA6BnB,MAA7B,CAAoC+B,MAApC,GAA4C,CAA1F,EAA4F;AAC9FtC,IAAAA,QAAQ,CAACQ,cAAc,CAACkB,GAAhB,CAAR,CAA6BnB,MAA7B,CAAoCsC,GAApC;AACArC,IAAAA,cAAc,GAAG,CAAC,CAAlB;AACAoC,IAAAA,YAAY;AACf,GAJK,MAID;AACD7B,IAAAA,WAAW;AACXF,IAAAA,OAAO,CAACC,GAAR,CAAY,sCAAZ;AACAD,IAAAA,OAAO,CAACC,GAAR,CAAY,2CAAZ;AACAD,IAAAA,OAAO,CAACC,GAAR,CAAY,sCAAZ;AACH,GAfsB,CAgBvB;;AAGP,CAnBD;;AAqBA,IAAIgC,YAAY,GAAG,MAAM;AACrB,MAAIC,MAAM,GAAG/B,QAAQ,CAACC,cAAT,CAAwB,eAAxB,EAAyCC,SAAzC,CAAmD8B,MAAnD,CAA0D,eAA1D,CAAb;AACH,CAFD;;AAKA,IAAIC,kBAAkB,GAAG,CAACC,YAAD,EAAeC,CAAf,EAAkBC,CAAlB,KAAuB;AAC5C,MAAIxC,KAAK,GAAG;AAACuC,IAAAA,CAAD;AAAIC,IAAAA;AAAJ,GAAZ;AACApD,EAAAA,QAAQ,CAACkD,YAAD,CAAR,CAAuB3C,MAAvB,CAA8B8B,IAA9B,CAAmCzB,KAAnC;AACH,CAHD;;AAKA,SAASyC,cAAT,CAAwBF,CAAxB,EAA2BC,CAA3B,EAA8B;AAC1BpD,EAAAA,QAAQ,CAACsD,OAAT,CAAiB,CAAC3C,OAAD,EAAUe,GAAV,KAAiB;AAC9B,SAAK,IAAIO,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGtB,OAAO,CAACJ,MAAR,CAAe+B,MAAnC,EAA2CL,CAAC,EAA5C,EAAgD;AAC5C,UAAIrB,KAAK,GAAGD,OAAO,CAACJ,MAAR,CAAe0B,CAAf,CAAZ;AACApB,MAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;;AACA,UAAIuC,CAAC,IAAIvC,KAAK,CAACuC,CAAN,GAAU,CAAf,IAAoBA,CAAC,IAAIvC,KAAK,CAACuC,CAAN,GAAU,CAAnC,IAAwCC,CAAC,IAAIxC,KAAK,CAACwC,CAAN,GAAU,CAAvD,IAA4DA,CAAC,IAAIxC,KAAK,CAACwC,CAAN,GAAU,CAA/E,EAAkF;AAC9E5C,QAAAA,cAAc,GAAG;AAACkB,UAAAA,GAAG,EAAEA,GAAN;AAAWd,UAAAA,KAAK,EAAEqB;AAAlB,SAAjB;AACAW,QAAAA,YAAY;AACZtC,QAAAA,cAAc,GAAG,IAAjB;AACA;AACH;AACJ;AACJ,GAXD;AAYH;;MAbQ+C,c;;AAcT,SAAS9D,eAAT,CAAyBgE,KAAzB,EAAgC;AAC5BtD,EAAAA,SAAS,GAAG,IAAZ;;AACA,MAAII,cAAJ,EAAoB;AAChB,QAAI8C,CAAC,GAAGI,KAAK,CAACC,OAAd;AACA,QAAIJ,CAAC,GAAGG,KAAK,CAACE,OAAd;AACAR,IAAAA,kBAAkB,CAACxC,aAAD,EAAgB0C,CAAhB,EAAmBC,CAAnB,CAAlB;AACAR,IAAAA,YAAY;AACZvC,IAAAA,cAAc,GAAG,KAAjB;AACH,GAND,MAOK;AACD8C,IAAAA,CAAC,GAAGI,KAAK,CAACC,OAAV;AACAJ,IAAAA,CAAC,GAAGG,KAAK,CAACE,OAAV;AACAJ,IAAAA,cAAc,CAACF,CAAD,EAAIC,CAAJ,CAAd;AACH;AAEJ;;MAfQ7D,e;;AAgBT,SAASE,eAAT,CAAyB8D,KAAzB,EAAgC;AAC5B,MAAItD,SAAJ,EAAe;AACX,QAAIK,cAAJ,EAAoB;AAChB,UAAIM,KAAK,GAAGZ,QAAQ,CAACQ,cAAc,CAACkB,GAAhB,CAAR,CAA6BnB,MAA7B,CAAoCC,cAAc,CAACI,KAAnD,CAAZ;AACAA,MAAAA,KAAK,CAACuC,CAAN,GAAUI,KAAK,CAACC,OAAhB;AACA5C,MAAAA,KAAK,CAACwC,CAAN,GAAUG,KAAK,CAACE,OAAhB;AACAb,MAAAA,YAAY;AACf;AACJ;AACJ;;MATQnD,e;;AAWT,SAASD,aAAT,GAAyB;AACrBS,EAAAA,SAAS,GAAG,KAAZ;AACAK,EAAAA,cAAc,GAAG,KAAjB;AACH;;MAHQd,a;;AAKT,SAASoD,YAAT,GAAwB;AACpB,MAAIG,MAAM,GAAG/B,QAAQ,CAACC,cAAT,CAAwB,eAAxB,CAAb;AACA,MAAIyC,GAAG,GAAGX,MAAM,CAACY,UAAP,CAAkB,IAAlB,CAAV;AACAD,EAAAA,GAAG,CAACE,SAAJ,CAAc,CAAd,EAAiB,CAAjB,EAAoBb,MAAM,CAACc,KAA3B,EAAkCd,MAAM,CAACe,MAAzC;;AACA,MAAIvD,MAAM,CAAC+B,MAAP,GAAgB,CAApB,EAAuB;AACnBzB,IAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACAiD,IAAAA,SAAS;AACZ;;AACD/D,EAAAA,QAAQ,CAACsD,OAAT,CAAiB,CAAC3C,OAAD,EAAUqD,IAAV,KAAmB;AAChC,SAAK,MAAMtC,GAAX,IAAkBf,OAAO,CAACJ,MAA1B,EAAkC;AAC9B,UAAIgC,MAAM,CAACC,cAAP,CAAsBC,IAAtB,CAA2B9B,OAAO,CAACJ,MAAnC,EAA2CmB,GAA3C,CAAJ,EAAqD;AACjD,YAAGf,OAAO,CAACJ,MAAR,CAAe+B,MAAf,GAAwB,CAA3B,EAA6B;AACzByB,UAAAA,SAAS;AACZ;;AACD,cAAMnD,KAAK,GAAGD,OAAO,CAACJ,MAAR,CAAemB,GAAf,CAAd;;AACA,YAAGuC,MAAM,CAACD,IAAD,CAAN,KAAiBxD,cAAc,CAACkB,GAAhC,IAAuCuC,MAAM,CAACvC,GAAD,CAAN,KAAgBlB,cAAc,CAACI,KAAzE,EAA+E;AAC3EsD,UAAAA,SAAS,CAACtD,KAAK,CAACuC,CAAP,EAAUvC,KAAK,CAACwC,CAAhB,EAAmB,MAAnB,CAAT;AACH,SAFD,MAEK;AACDc,UAAAA,SAAS,CAACtD,KAAK,CAACuC,CAAP,EAAUvC,KAAK,CAACwC,CAAhB,EAAmBzC,OAAO,CAACqB,KAA3B,CAAT;AACH;AACJ;AACJ;AACJ,GAdD;AAgBH;;MAxBQY,Y;;AA0BT,SAASsB,SAAT,CAAmBf,CAAnB,EAAsBC,CAAtB,EAAyBpB,KAAzB,EAAgC;AAC5B,MAAIe,MAAM,GAAG/B,QAAQ,CAACC,cAAT,CAAwB,eAAxB,CAAb;AACA,MAAIyC,GAAG,GAAGX,MAAM,CAACY,UAAP,CAAkB,IAAlB,CAAV;AACAD,EAAAA,GAAG,CAACS,SAAJ;AACAT,EAAAA,GAAG,CAACU,GAAJ,CAAQjB,CAAR,EAAWC,CAAX,EAAc,CAAd,EAAiB,CAAjB,EAAoBiB,UAAU,CAAC,GAAD,CAA9B;AACAX,EAAAA,GAAG,CAACY,SAAJ,GAAgBtC,KAAhB;AACA0B,EAAAA,GAAG,CAACa,MAAJ,CAAWpB,CAAX,EAAcC,CAAd;AACAM,EAAAA,GAAG,CAACc,IAAJ;AACH;;MARQN,S;;AAUT,SAASH,SAAT,GAAqB;AACjB,MAAIhB,MAAM,GAAG/B,QAAQ,CAACC,cAAT,CAAwB,eAAxB,CAAb;AACA,MAAIyC,GAAG,GAAGX,MAAM,CAACY,UAAP,CAAkB,IAAlB,CAAV;AACA9C,EAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;;AACA,OAAK,MAAMY,GAAX,IAAkB1B,QAAlB,EAA4B;AACxB,QAAIuC,MAAM,CAACC,cAAP,CAAsBC,IAAtB,CAA2BzC,QAA3B,EAAqC0B,GAArC,CAAJ,EAAgD;AAC5C,YAAMf,OAAO,GAAGX,QAAQ,CAAC0B,GAAD,CAAxB;;AACA,UAAGf,OAAO,CAACJ,MAAR,CAAe+B,MAAf,GAAwB,CAA3B,EAA8B;AAC1BoB,QAAAA,GAAG,CAACa,MAAJ,CAAW5D,OAAO,CAACJ,MAAR,CAAe,CAAf,EAAkB4C,CAA7B,EAAgCxC,OAAO,CAACJ,MAAR,CAAe,CAAf,EAAkB6C,CAAlD;AACAvC,QAAAA,OAAO,CAACC,GAAR,CAAYH,OAAZ;;AACA,aAAK,IAAIsB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGtB,OAAO,CAACJ,MAAR,CAAe+B,MAAnC,EAA2CL,CAAC,EAA5C,EAAgD;AAC5CyB,UAAAA,GAAG,CAACe,MAAJ,CAAW9D,OAAO,CAACJ,MAAR,CAAe0B,CAAf,EAAkBkB,CAA7B,EAAgCxC,OAAO,CAACJ,MAAR,CAAe0B,CAAf,EAAkBmB,CAAlD;AACAM,UAAAA,GAAG,CAACgB,WAAJ,GAAkB/D,OAAO,CAACqB,KAA1B;AACH;AACJ;AACJ;;AACD0B,IAAAA,GAAG,CAACiB,MAAJ;AACAjB,IAAAA,GAAG,CAACS,SAAJ;AACH;AAEJ;;OApBQJ,S;;AAsBT,SAASM,UAAT,CAAoBO,OAApB,EAA6B;AACzB,SAAQ1C,IAAI,CAAC2C,EAAL,GAAU,GAAX,GAAkBD,OAAzB;AACH;;AAED,IAAIE,SAAS,GAAG,CAACC,EAAD,EAAKC,EAAL,EAASC,EAAT,EAAaC,EAAb,EAAiBC,EAAjB,EAAqBC,EAArB,EAAyBC,EAAzB,EAA6BC,EAA7B,KAAoC;AAC5C;AACE,MAAKP,EAAE,KAAKE,EAAP,IAAaD,EAAE,KAAKE,EAArB,IAA6BC,EAAE,KAAKE,EAAP,IAAaD,EAAE,KAAKE,EAArD,EAA0D;AACtD,WAAO,KAAP;AACH;;AAED,MAAIC,WAAW,GAAI,CAACD,EAAE,GAAGF,EAAN,KAAaH,EAAE,GAAGF,EAAlB,IAAwB,CAACM,EAAE,GAAGF,EAAN,KAAaD,EAAE,GAAGF,EAAlB,CAA3C,CAN0C,CAQ5C;;AACE,MAAIO,WAAW,KAAK,CAApB,EAAuB;AACnB,WAAO,KAAP;AACH;;AAED,MAAIC,EAAE,GAAG,CAAC,CAACH,EAAE,GAAGF,EAAN,KAAaH,EAAE,GAAGI,EAAlB,IAAwB,CAACE,EAAE,GAAGF,EAAN,KAAaL,EAAE,GAAGI,EAAlB,CAAzB,IAAkDI,WAA3D;AACA,MAAIE,EAAE,GAAG,CAAC,CAACR,EAAE,GAAGF,EAAN,KAAaC,EAAE,GAAGI,EAAlB,IAAwB,CAACF,EAAE,GAAGF,EAAN,KAAaD,EAAE,GAAGI,EAAlB,CAAzB,IAAkDI,WAA3D,CAd0C,CAgB5C;;AACE,MAAIC,EAAE,GAAG,CAAL,IAAUA,EAAE,GAAG,CAAf,IAAoBC,EAAE,GAAG,CAAzB,IAA8BA,EAAE,GAAG,CAAvC,EAA0C;AACtC,WAAO,KAAP;AACH,GAnByC,CAqB5C;;;AACE,MAAItC,CAAC,GAAG4B,EAAE,GAAGS,EAAE,IAAIP,EAAE,GAAGF,EAAT,CAAf;AACA,MAAI3B,CAAC,GAAG4B,EAAE,GAAGQ,EAAE,IAAIN,EAAE,GAAGF,EAAT,CAAf;AAEA,SAAO;AAAC7B,IAAAA,CAAD;AAAIC,IAAAA;AAAJ,GAAP;AACT,CA1BD;;AA6BA,IAAIvD,YAAY,GAAG,MAAK;AACpB;AAEI,MAAI6F,QAAQ,GAAGC,WAAW,EAA1B;AACJ9E,EAAAA,OAAO,CAACC,GAAR,CAAY4E,QAAZ;;AACA,OAAK,IAAIzD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGyD,QAAQ,CAACpD,MAAT,GAAiB,CAArC,EAAwCL,CAAC,EAAzC,EAA6C;AACzC,SAAK,IAAImB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGsC,QAAQ,CAACpD,MAA7B,EAAqCc,CAAC,EAAtC,EAA0C;AACtC,YAAMwC,KAAK,GAAGF,QAAQ,CAACzD,CAAD,CAAtB;AACJpB,MAAAA,OAAO,CAACC,GAAR,CAAY,sCAAZ;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAY,kBAAkBmB,CAA9B;AACApB,MAAAA,OAAO,CAACC,GAAR,CAAY,sCAAZ;AACI,YAAM+E,KAAK,GAAGH,QAAQ,CAACtC,CAAD,CAAtB,CALsC,CAMtC;;AACA,UAAIxC,KAAK,GAAGkE,SAAS,CAACc,KAAK,CAACb,EAAP,EAAWa,KAAK,CAACZ,EAAjB,EAAqBY,KAAK,CAACX,EAA3B,EAA+BW,KAAK,CAACV,EAArC,EAAyCW,KAAK,CAACd,EAA/C,EAAmDc,KAAK,CAACb,EAAzD,EAA4Da,KAAK,CAACZ,EAAlE,EAAsEY,KAAK,CAACX,EAA5E,CAArB;AACArE,MAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;;AACA,UAAGA,KAAK,CAACuC,CAAN,IAAWvC,KAAK,CAACwC,CAApB,EAAsB;AAClB,YAAGxC,KAAK,CAACuC,CAAN,GAAU,CAAV,IAAevC,KAAK,CAACwC,CAAN,GAAU,CAA5B,EAA8B;AAC1BvC,UAAAA,OAAO,CAACC,GAAR,CAAY,sCAAZ;AACAD,UAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;AACAD,UAAAA,OAAO,CAACC,GAAR,CAAY,sCAAZ;AACH,SAJD,MAIM,IAAIF,KAAK,CAACuC,CAAN,IAAWyC,KAAK,CAACX,EAAjB,IAAuBrE,KAAK,CAACwC,CAAN,IAAWwC,KAAK,CAACV,EAAxC,IACAtE,KAAK,CAACuC,CAAN,IAAW0C,KAAK,CAACd,EAAjB,IAAuBnE,KAAK,CAACwC,CAAN,IAAWyC,KAAK,CAACb,EADxC,IAEApE,KAAK,CAACuC,CAAN,IAAWyC,KAAK,CAACb,EAAjB,IAAuBnE,KAAK,CAACwC,CAAN,IAAWwC,KAAK,CAACZ,EAFxC,IAGApE,KAAK,CAACuC,CAAN,IAAW0C,KAAK,CAACZ,EAAjB,IAAuBrE,KAAK,CAACwC,CAAN,IAAWyC,KAAK,CAACX,EAH5C,EAGiD;AACnDrE,UAAAA,OAAO,CAACC,GAAR,CAAY,sCAAZ;AACAD,UAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;AACAD,UAAAA,OAAO,CAACC,GAAR,CAAY,sCAAZ;AACH,SAPK,MAOD;AACDoD,UAAAA,SAAS,CAACtD,KAAK,CAACuC,CAAP,EAAUvC,KAAK,CAACwC,CAAhB,EAAmB,KAAnB,CAAT;AACH;AACJ;AACJ;AAGJ;AACJ,CAnCD;;AAqCA,IAAIuC,WAAW,GAAG,MAAM;AACpB,MAAID,QAAQ,GAAG,EAAf;;AACA,OAAK,IAAIzD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGjC,QAAQ,CAACsC,MAA7B,EAAqCL,CAAC,EAAtC,EAA0C;AAAE;AACxC,SAAK,IAAImB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGpD,QAAQ,CAACiC,CAAD,CAAR,CAAY1B,MAAZ,CAAmB+B,MAAvC,EAA+Cc,CAAC,EAAhD,EAAoD;AAAE;AAClD,UAAIwC,KAAK,GAAG,EAAZ;;AACA,UAAG5F,QAAQ,CAACiC,CAAD,CAAR,CAAY1B,MAAZ,CAAmB6C,CAAC,GAAC,CAArB,CAAH,EAA2B;AACvBwC,QAAAA,KAAK,GAAG;AAACb,UAAAA,EAAE,EAAC/E,QAAQ,CAACiC,CAAD,CAAR,CAAY1B,MAAZ,CAAmB6C,CAAnB,EAAsBD,CAA1B;AACC6B,UAAAA,EAAE,EAAChF,QAAQ,CAACiC,CAAD,CAAR,CAAY1B,MAAZ,CAAmB6C,CAAnB,EAAsBA,CAD1B;AAEC6B,UAAAA,EAAE,EAACjF,QAAQ,CAACiC,CAAD,CAAR,CAAY1B,MAAZ,CAAmB6C,CAAC,GAAC,CAArB,EAAwBD,CAF5B;AAGC+B,UAAAA,EAAE,EAAClF,QAAQ,CAACiC,CAAD,CAAR,CAAY1B,MAAZ,CAAmB6C,CAAC,GAAC,CAArB,EAAwBA;AAH5B,SAAR;AAISsC,QAAAA,QAAQ,CAACrD,IAAT,CAAcuD,KAAd;AACZ,OAND,MAMK;AACD;AACH;AAIJ;AACJ;;AACD,SAAOF,QAAP;AACH,CApBD","sourcesContent":["import React, { Component } from 'react';\r\nimport { render } from 'react-dom'\r\n//import { CanvasBoard } from './CanvasBoard'\r\n//mport { PiplineSegment } from './PiplineSegment'\r\nimport './css/Pipline.css'\r\nimport { PiplineSegment } from './PiplineSegment';\r\n\r\nexport class Pipline extends Component {\r\n    static dislpayName = Pipline.name;\r\n\r\n    state = {\r\n        piplinesSegmentCount: 0\r\n    }\r\n\r\n    render(){\r\n        return (\r\n            <section className=\"piplineSections\">\r\n                <div className=\"alert alert-danger alert-dismissible fade\" id=\"alert-message\" role=\"alert\">\r\n                    Удалять можно только точки скраю трубопровода\r\n                        <button type=\"button\" className=\"close\" data-dismiss=\"alert\" aria-label=\"Close\" onClick={closeAlert}>\r\n                            <span aria-hidden=\"true\">&times;</span>\r\n                        </button>\r\n                    </div>\r\n                <div className=\"container\">\r\n                    <div className=\"pipline-title mx-auto\">\r\n                        <h1>Тестовое задание</h1>\r\n                        <h6>Задача: реализовать построение и обработку трубопроводов с проверкой коллизий</h6>\r\n                    </div>\r\n                   <div className=\"row\">\r\n                        <div className=\"col-xxl-8 col-xl-8 col-lg-8\">\r\n                            <div className=\"canvasContainer\">\r\n                                <canvas id=\"piplineCanvas\" width=\"700\" height=\"350\"\r\n                                    onMouseDown={(e) => {\r\n                                        let newEvent = e.nativeEvent;\r\n                                        HandleMouseDown(newEvent)\r\n                                    }}\r\n                                    onMouseUp={e => {\r\n                                        let newEvent = e.nativeEvent;\r\n                                        HandleMouseUp(newEvent);\r\n                                    }}\r\n                                    onMouseMove={e => {\r\n                                        let newEvent = e.nativeEvent;\r\n                                        HandleMouseMove(newEvent);\r\n                                    }}                                >\r\n                                </canvas>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"col-xxl-4 col-xl-4 col-lg-4\">\r\n                            <div className=\"boardContainer\">\r\n                                <div className=\"canvasBoard_componen\">\r\n                                    <button className=\"btn btn-primary\" onClick={AddPipline}> Добавить новый трубопровод </button>\r\n                                    <button className=\"btn btn-success\" onClick={SetAddPointActive}> Добавить узел </button>\r\n                                    <button className=\"btn btn-danger\" onClick={deleteSelectedPoint}> Удалить узел </button>\r\n                                    <button className=\"btn btn-warning\" onClick={getCollisium}> Рассчитать пересечения</button>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"piplineElements\" id=\"piplineItems\">\r\n                                <ul className=\"piplineList\" id=\"piplineList\">\r\n                                    \r\n                                </ul>\r\n                            </div>\r\n                        </div>\r\n                   </div>\r\n                </div>    \r\n            </section>\r\n           \r\n        );\r\n    }\r\n\r\n\r\n    \r\n}\r\n\r\n\r\n\r\nlet piplines = []\r\nlet mouseDown = false\r\nlet piplinesCount = 0;\r\nlet defaultId = 0;\r\nlet defaultPoint = [0, 0]\r\nlet AddPointActive = false\r\nlet downOnSelected = false;\r\nlet points = []\r\nlet selectedNumber = -1;\r\nlet activePipline = -1;\r\nlet linesArr = []\r\n\r\n \r\n\r\nfunction SetAddPointActive(pipline, point) {\r\n    AddPointActive = true;\r\n    console.log(\"Add active\");\r\n}\r\n\r\n\r\nlet renderAlert = () => {\r\n    document.getElementById('alert-message').classList.add('show')\r\n    autoCloseAlert()\r\n}\r\nlet autoCloseAlert = () => {\r\n    setTimeout(() => {\r\n        closeAlert()\r\n    }, 3000);\r\n}\r\nlet closeAlert= () => {\r\n    document.getElementById('alert-message').classList.remove('show')\r\n}\r\n\r\nfunction renderPiplineItems() {\r\n    return render(\r\n        piplines.map((item, key) => (\r\n            <li key={item.id} id={key + \"pipline\"}>\r\n                <button className=\"pipline-btn\" type=\"button\" onClick={() =>setPipline(key)}>{item.name}</button> \r\n                    <button type=\"button\" className=\"close red\" aria-label=\"Close\" onClick={()=>DeletePipline(item.id)}>\r\n                            <span aria-hidden=\"true\">&times;</span>\r\n                    </button>\r\n            </li>\r\n        )),\r\n        document.getElementById('piplineList')\r\n    );\r\n}\r\n//TODO поправить назначение активного пайплпайна при удалении. Сейчас он на ID ссылается, а надо на ключь\r\n//НУЖНО ИСПОЛЬЗОВАТЬ НЕ ID а KEY\r\nfunction setPipline(key) {\r\n    if (activePipline !== key && activePipline !== -1 && document.getElementById(activePipline + \"pipline\")) {\r\n        document.getElementById(activePipline + \"pipline\").classList.remove('pipline-btn__active')\r\n    }\r\n    let pipline = document.getElementById(key + \"pipline\")\r\n\r\n    if(pipline){\r\n        pipline.classList.add('pipline-btn__active')\r\n        activePipline = key;\r\n\r\n    }\r\n    \r\n}\r\n\r\nfunction getRandomColor() {\r\n    var letters = '0123456789ABCDEF';\r\n    var color = '#';\r\n    for (var i = 0; i < 6; i++) {\r\n        color += letters[Math.floor(Math.random() * 16)];\r\n    }\r\n    return color;\r\n}\r\n\r\nfunction AddPipline() {\r\n    let color = getRandomColor()\r\n    let pipline = {\r\n        id: piplinesCount + 1,\r\n        name: \"Трубопровод \" + (piplinesCount + 1),\r\n        color: color,\r\n        points: []\r\n    }\r\n    piplines.push(pipline)\r\n    piplinesCount += 1\r\n    renderPiplineItems()\r\n    if (piplines.length <= 1) {\r\n        activePipline = 0\r\n        setPipline(0)\r\n    }\r\n\r\n}\r\n\r\n\r\n//Проверить перед деплоем\r\nfunction DeletePipline(id) {\r\n\r\n    for (const key in piplines) {\r\n        if (Object.hasOwnProperty.call(piplines, key)) {\r\n            const pipline = piplines[key];\r\n            if(pipline.id === id){\r\n                console.log(key);\r\n                if(key === '0'){\r\n                    console.log(\"0000\");\r\n                    piplines.shift()\r\n                    piplinesCount = 0\r\n                    activePipline = -1\r\n                }else{\r\n                    piplines.splice(key, key)\r\n                }\r\n                renderPiplineItems();\r\n                DrawPipeline();\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nlet deleteSelectedPoint = () =>{\r\n    // if(selectedNumber && selectedNumber.point === 0 || selectedNumber.point === piplines[selectedNumber.key].points.length -1){\r\n        if(selectedNumber && selectedNumber.point === 0){\r\n            piplines[selectedNumber.key].points.shift()\r\n            selectedNumber = -1;\r\n            DrawPipeline()\r\n        }else if(selectedNumber && selectedNumber.point === piplines[selectedNumber.key].points.length -1){\r\n            piplines[selectedNumber.key].points.pop()\r\n            selectedNumber = -1;\r\n            DrawPipeline()\r\n        }else{\r\n            renderAlert()\r\n            console.log('====================================');\r\n            console.log(\"точка  должна быть крайней в трубопроводе\");\r\n            console.log('====================================');\r\n        }\r\n        // piplines[selectedNumber.key].points.splice(selectedNumber.point, 1)\r\n       \r\n    \r\n}\r\n\r\nlet activeCanvas = () => {\r\n    let canvas = document.getElementById('piplineCanvas').classList.toggle('canvas_active')\r\n}\r\n\r\n\r\nlet addPointsToPipline = (piplineIndex, x, y) =>{\r\n    let point = {x, y};\r\n    piplines[piplineIndex].points.push(point);\r\n}\r\n\r\nfunction TrySelectPoint(x, y) {\r\n    piplines.forEach((pipline, key) =>{\r\n        for (var i = 0; i < pipline.points.length; i++) {\r\n            var point = pipline.points[i];\r\n            console.log(point);\r\n            if (x >= point.x - 5 && x <= point.x + 5 && y >= point.y - 5 && y <= point.y + 5) {\r\n                selectedNumber = {key: key, point: i};\r\n                DrawPipeline();\r\n                downOnSelected = true;\r\n                break\r\n            }\r\n        }\r\n    })    \r\n}\r\nfunction HandleMouseDown(event) {\r\n    mouseDown = true;\r\n    if (AddPointActive) {\r\n        var x = event.offsetX;\r\n        var y = event.offsetY;\r\n        addPointsToPipline(activePipline, x, y)\r\n        DrawPipeline();\r\n        AddPointActive = false;\r\n    }\r\n    else {\r\n        x = event.offsetX;\r\n        y = event.offsetY;\r\n        TrySelectPoint(x, y);\r\n    }\r\n\r\n}\r\nfunction HandleMouseMove(event) {\r\n    if (mouseDown) {\r\n        if (downOnSelected) {\r\n            let point = piplines[selectedNumber.key].points[selectedNumber.point];\r\n            point.x = event.offsetX;\r\n            point.y = event.offsetY;\r\n            DrawPipeline();\r\n        }\r\n    }\r\n}\r\n\r\nfunction HandleMouseUp() {\r\n    mouseDown = false;\r\n    downOnSelected = false;\r\n}\r\n\r\nfunction DrawPipeline() {\r\n    var canvas = document.getElementById('piplineCanvas');\r\n    var ctx = canvas.getContext('2d');\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    if (points.length > 0) {\r\n        console.log('driwe line');\r\n        DrawLines();\r\n    }\r\n    piplines.forEach((pipline, keys) => {\r\n        for (const key in pipline.points) {\r\n            if (Object.hasOwnProperty.call(pipline.points, key)) {\r\n                if(pipline.points.length > 0){\r\n                    DrawLines();\r\n                }\r\n                const point = pipline.points[key];\r\n                if(Number(keys) === selectedNumber.key && Number(key) === selectedNumber.point){\r\n                    DrawPoint(point.x, point.y, \"blue\")\r\n                }else{\r\n                    DrawPoint(point.x, point.y, pipline.color)\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n}\r\n\r\nfunction DrawPoint(x, y, color) {\r\n    var canvas = document.getElementById('piplineCanvas');\r\n    var ctx = canvas.getContext('2d');\r\n    ctx.beginPath();\r\n    ctx.arc(x, y, 5, 0, getRadians(360));\r\n    ctx.fillStyle = color;\r\n    ctx.moveTo(x, y);\r\n    ctx.fill();\r\n}\r\n\r\nfunction DrawLines() {\r\n    var canvas = document.getElementById('piplineCanvas');\r\n    var ctx = canvas.getContext('2d');\r\n    console.log('drawLines');\r\n    for (const key in piplines) {\r\n        if (Object.hasOwnProperty.call(piplines, key) ) {\r\n            const pipline = piplines[key];\r\n            if(pipline.points.length > 0 ){\r\n                ctx.moveTo(pipline.points[0].x, pipline.points[0].y);\r\n                console.log(pipline);\r\n                for (var i = 0; i < pipline.points.length; i++) {\r\n                    ctx.lineTo(pipline.points[i].x, pipline.points[i].y);                \r\n                    ctx.strokeStyle = pipline.color;\r\n                }\r\n            }\r\n        }\r\n        ctx.stroke()\r\n        ctx.beginPath();\r\n    }\r\n\r\n}\r\n\r\nfunction getRadians(degrees) {\r\n    return (Math.PI / 180) * degrees;\r\n}\r\n\r\nlet intersect = (x1, y1, x2, y2, x3, y3, x4, y4) => {\r\n        // Check if none of the lines are of length 0\r\n          if ((x1 === x2 && y1 === y2) || (x3 === x4 && y3 === y4)) {\r\n              return false\r\n          }\r\n      \r\n          let denominator = ((y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1))\r\n      \r\n        // Lines are parallel\r\n          if (denominator === 0) {\r\n              return false\r\n          }\r\n      \r\n          let ua = ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) / denominator\r\n          let ub = ((x2 - x1) * (y1 - y3) - (y2 - y1) * (x1 - x3)) / denominator\r\n      \r\n        // is the intersection along the segments\r\n          if (ua < 0 || ua > 1 || ub < 0 || ub > 1) {\r\n              return false\r\n          }\r\n      \r\n        // Return a object with the x and y coordinates of the intersection\r\n          let x = x1 + ua * (x2 - x1)\r\n          let y = y1 + ua * (y2 - y1)\r\n      \r\n          return {x, y}\r\n}\r\n\r\n\r\nlet getCollisium = () =>{\r\n    //при первой иттерации, убираем первый элемент первого массива из расчетов т.к. с ним высчитывать уже нет смысла - т.к. в первой же иттерации он сравнивает себя с всеми отрезками \r\n\r\n        let allLines = getAlllines()\r\n    console.log(allLines);\r\n    for (let i = 0; i < allLines.length -1; i++) {\r\n        for (let y = 1; y < allLines.length; y++) {\r\n            const line1 = allLines[i];\r\n        console.log('====================================');\r\n        console.log(\"itteration № \" + i);\r\n        console.log('====================================');\r\n            const line2 = allLines[y]\r\n            //let point = line_intersect(line1, line2);\r\n            let point = intersect(line1.x1, line1.y1, line1.x2, line1.y2, line2.x1, line2.y1,line2.x2, line2.y2)\r\n            console.log(point);\r\n            if(point.x && point.y){\r\n                if(point.x < 0 && point.y < 0){\r\n                    console.log('====================================');\r\n                    console.log('break');\r\n                    console.log('====================================');\r\n                }else if( point.x == line1.x2 && point.y == line1.y2 || \r\n                          point.x == line2.x1 && point.y == line2.y1 || \r\n                          point.x == line1.x1 && point.y == line1.y1 || \r\n                          point.x == line2.x2 && point.y == line2.y2)  {\r\n                    console.log('====================================');\r\n                    console.log(\"point\");\r\n                    console.log('====================================');\r\n                }else{\r\n                    DrawPoint(point.x, point.y, \"red\")\r\n                }\r\n            }\r\n        }\r\n        \r\n        \r\n    }\r\n}\r\n\r\nlet getAlllines = () => { \r\n    let allLines = []\r\n    for (let i = 0; i < piplines.length; i++) { //количество иттераций от количества пайплайнов:\r\n        for (let y = 0; y < piplines[i].points.length; y++) { //вложенные иттерации от количества поинтов в пайплайне \r\n            let line1 = {}\r\n            if(piplines[i].points[y+1]){\r\n                line1 = {x1:piplines[i].points[y].x, \r\n                         y1:piplines[i].points[y].y,\r\n                         x2:piplines[i].points[y+1].x, \r\n                         y2:piplines[i].points[y+1].y}\r\n                         allLines.push(line1)\r\n            }else{\r\n                break;\r\n            }\r\n        \r\n\r\n            \r\n        }\r\n    }\r\n    return allLines;\r\n}"]},"metadata":{},"sourceType":"module"}